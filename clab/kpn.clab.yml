# Copyright 2024 Nokia
# Licensed under the BSD 3-Clause License.
# SPDX-License-Identifier: BSD-3-Clause

name: kpn-hackathon
prefix: ""

mgmt:
  network: kpn-hackathon # management network name
  ipv4-subnet: 10.128.1.0/24 # ipv4 range

topology:
  defaults:
    kind: linux
    image: ghcr.io/srl-labs/network-multitool
  kinds:
    nokia_srlinux:
      image: ghcr.io/nokia/srlinux:25.10.1
    linux:
      image: ghcr.io/srl-labs/network-multitool
  nodes:
    # DCF
    spine1:
      kind: nokia_srlinux
      type: ixr-h4-32d
      mgmt-ipv4: 10.128.1.31
      ports:
        - 50031:22
        - 50331:57400
    spine2:
      kind: nokia_srlinux
      type: ixr-h4-32d
      mgmt-ipv4: 10.128.1.32
      ports:
        - 50032:22
        - 50332:57400
    leaf1:
      kind: nokia_srlinux
      type: ixr-d3l
      mgmt-ipv4: 10.128.1.33
      ports:
        - 50033:22
        - 50333:57400
    leaf2:
      kind: nokia_srlinux
      type: ixr-d3l
      mgmt-ipv4: 10.128.1.34
      ports:
        - 50034:22
        - 50334:57400
    leaf3:
      kind: nokia_srlinux
      type: ixr-d3l
      mgmt-ipv4: 10.128.1.35
      ports:
        - 50035:22
        - 50335:57400
    borderleaf1:
      kind: nokia_srlinux
      type: ixr-d3l
      mgmt-ipv4: 10.128.1.36
      ports:
        - 50036:22
        - 50336:57400
    borderleaf2:
      kind: nokia_srlinux
      type: ixr-d3l
      mgmt-ipv4: 10.128.1.37
      ports:
        - 50037:22
        - 50337:57400
    client1:
      mgmt-ipv4: 10.128.1.38
      binds:
        - configs/client/interfaces-client1:/etc/network/interfaces
        - configs/client/frr1.conf:/etc/frr/frr.conf
        - configs/client/client.sh:/client.sh
      exec:
        - bash /client.sh
        - sudo apk add frr
        - sudo sed "s/bgpd=no/bgpd=yes/" -i /etc/frr/daemons
        - sudo /usr/lib/frr/frrinit.sh start
      ports:
        - 50038:22
      env:
        USER_PASSWORD: ${EVENT_PASSWORD}
    client2:
      mgmt-ipv4: 10.128.1.39
      binds:
        - configs/client/client2.sh:/client.sh
      exec:
        - bash /client.sh
      ports:
        - 50039:22
      env:
        USER_PASSWORD: ${EVENT_PASSWORD}
    client3:
      mgmt-ipv4: 10.128.1.40
      binds:
        - configs/client/interfaces-client3:/etc/network/interfaces
        - configs/client/frr3.conf:/etc/frr/frr.conf
        - configs/client/client.sh:/client.sh
      exec:
        - bash /client.sh
        - sudo apk add frr
        - sudo sed "s/bgpd=no/bgpd=yes/" -i /etc/frr/daemons
        - sudo /usr/lib/frr/frrinit.sh start
      ports:
        - 50040:22
      env:
        USER_PASSWORD: ${EVENT_PASSWORD}
    client4:
      mgmt-ipv4: 10.128.1.41
      binds:
        - configs/client/client2.sh:/client.sh
        - configs/client/frr4.conf:/etc/frr/frr.conf
      exec:
        - bash /client.sh
        - sudo apk add frr
        - sudo sed "s/bgpd=no/bgpd=yes/" -i /etc/frr/daemons
        - sudo /usr/lib/frr/frrinit.sh start
      ports:
        - 50041:22
      env:
        USER_PASSWORD: ${EVENT_PASSWORD}
    client5:
      mgmt-ipv4: 10.128.1.42
      binds:
        - configs/client/interfaces-client5:/etc/network/interfaces
        - configs/client/frr5.conf:/etc/frr/frr.conf
        - configs/client/client.sh:/client.sh
      exec:
        - bash /client.sh
        - sudo apk add frr
        - sudo sed "s/bgpd=no/bgpd=yes/" -i /etc/frr/daemons
        - sudo /usr/lib/frr/frrinit.sh start
      ports:
        - 50042:22
      env:
        USER_PASSWORD: ${EVENT_PASSWORD}

  links:

    # links from spine1/2 to leafs
    - endpoints: [ "spine1:e1-1", "leaf1:e1-31" ]
    - endpoints: [ "spine1:e1-2", "leaf2:e1-31" ]
    - endpoints: [ "spine1:e1-3", "leaf3:e1-31" ]
    - endpoints: [ "spine2:e1-1", "leaf1:e1-32" ]
    - endpoints: [ "spine2:e1-2", "leaf2:e1-32" ]
    - endpoints: [ "spine2:e1-3", "leaf3:e1-32" ]
    # links from spine1/2 to borderleafs
    - endpoints: [ "spine1:e1-4", "borderleaf1:e1-31" ]
    - endpoints: [ "spine1:e1-5", "borderleaf2:e1-31" ]
    - endpoints: [ "spine2:e1-4", "borderleaf1:e1-32" ]
    - endpoints: [ "spine2:e1-5", "borderleaf2:e1-32" ]
    # links from leaf1/2/3 to clients
    - endpoints: [ "leaf1:e1-1", "client1:eth1" ]
    - endpoints: [ "leaf1:e1-2", "client2:eth1" ]
    - endpoints: [ "leaf2:e1-1", "client2:eth2" ]
    - endpoints: [ "leaf3:e1-1", "client3:eth1" ]
    - endpoints: [ "leaf3:e1-2", "client4:eth1" ]
    # links from borderleaf1/2 to clients
    - endpoints: [ "borderleaf1:e1-1", "client5:eth1" ]
    - endpoints: [ "borderleaf2:e1-1", "client5:eth2" ]